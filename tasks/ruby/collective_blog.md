# Задание на практику

Разработать простой коллективный блог по типу habrahabr.ru

## Используемые технологии

* Rails 5.1
* Ruby 2.5
* Bootstrap 4
* PostgreSQL, при разработке тоже
* Devise и CanCanCan
* Kaminari
* Redcarpet
* Git и GitHub
* Rubocop с [вот этим конфигом](https://github.com/SibdevCompany/learn/blob/master/dotfiles/ruby/.rubocop.yml)
* bootstrap_form
* [Foreman](https://github.com/ddollar/foreman) и файлы .env для настроек. Procfile. Настройка подключения к базе данных в переменной DATABASE_URL, в формате ссылки
* Ubuntu или любая другая UNIX-подобная ОС (виртуальная машина тоже подойдет)

Желательно (прежде всего, для вашего же удобства при разработке):

* Atom (поскольку работать вы будете с Git, а интеграция атома и гита/гитхаба - божественная)
* Плагин Rubocop для Atom

Плюсиками в карму будут:

* RSpec и настроенный Travis CI
* Качество кода

## Как мы хотим, чтобы это выглядело

Список страниц:

* Регистрация
* Авторизация
* Главная
* Пост
* Создание и редактирование поста
* Карточка автора

Страница создания и редактирования поста должна проверять, авторизован ли пользователь

У пользователя должен быть флаг "администратор", позволяющий ему редактировать и удалять любой пост

### Регистрация и авторизация

Чуть кастомизированные страницы Devise

### Главная

На этой странице выводится по 10 постов, отсортированные по дате создания (старые - внизу, новые - вверху).

Пост:

* Заголовок
* Автор (ссылка на карточку) и дата написания
* Описание
* Кнопка "подробнее"

Внизу страницы - кнопки "назад" и "вперёд", номер текущей страницы, номера-ссылки одной предыдущей и одной последующей.

Требования к пагинации:

Использовать Kaminari.

### Пост

Страница поста

* Заголовок
* Автор (ссылка на карточку) и дата написания
* Описание
* Разделитель
* Основной текст

Если текущий пользователь - автор этого поста, либо админ, то:

* Кнопка "редактировать"
* Кнопка "удалить"

Права доступа проверяются через CanCanCan

### Создание и редактирование

Поле для ввода заголовка, описание и текст поста с wysiwyg-редактором (Markdown).

### Карточка автора

Имя и список ссылок на посты, отсортированных по дате создания поста, без пагинации

## Чекпоинты

Чекпоинты - это те этапы, на выполнение которых мы будем смотреть. Крайне рекомендуется приступать к выполнению следующего этапа ТОЛЬКО после того, как мы успешно примем предыдущий

### Установка Linux, необходимого ПО, регистрация на GitHub

Для начала, нужно установить Linux либо в виртуальной машине, либо, если не позволяет мощность ПК или есть достаточный опыт, на реальную машину.

Крайне рекомендую для начала использовать Ubuntu 16.04, либо Xubuntu 16.04, если ставите на виртуальную машину или слабый ПК.

После установки ОС, нужно установить следующее ПО:

*Все команды нужно выполнять при помощи приложения "Терминал".*

#### Atom

Atom - удобный текстовый редактор с кучей полезных плагинов

1. Скачать deb-пакет с atom.io
2. Установить командой `sudo dpkg -i имяфайла.deb`, находясь в нужной папке (команды `ls`, `l`, `ll`, `cd`, а так же автодополнение по нажатию на `Tab` - ваши лучшие друзья)

#### Ruby и Foreman

Ruby 2.5:

https://www.brightbox.com/blog/2018/02/05/ruby-2-5-ubuntu-packages/

Foreman:

Foreman позволяет удобно работать с переменными окружения, задавая их в файле `.env`

`gem install foreman` (с `sudo`, если предыдущая команда падает с ошибкой доступа)

#### Регистрация на github, rsa-ключ

Заходим на github.com и регистрируемся. Гуглим, как на ubuntu сгенерировать rsa-ключ и добавить его в аккаунт github (это позволит работать с github, не вводя пароль при каждом действии в удаленном репозитории)

Если вы дошли досюда, самое время доложиться и показать достигнутое :)

### Задание на паттерны

Сперва, немного отвлечёмся от веба и сделаем [простое задание на паттерны проектирования](../common/pubsub_and_observer.md)

### Создаем проект

Возвращаемся к вебу

Для начала, установим необходимые пакеты (внимание, Ubuntu 16.04!!!!)

```
curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list

sudo apt-get update
sudo apt-get install git-core curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libpq-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev nodejs yarn
```

Устанавливаем Rails:

`gem install rails`

Генерируем rails-приложение:

`rails new blog -T --database=postgresql`

### Структура БД

В текстовом формате опишите, какой должна быть БД с учетом всех требований. Обязательно отправьте этот этап на проверку перед выполнением следующих.

Все поля опишите в формате, в котором их принимает генератор моделей (column_name:type)

Структуру для модели пользователя описывать не нужно, кроме того факта, что у него будет одно нестандартное поле admin:boolean (имя - admin, тип - boolean).

### Docker и docker-compose, Procfile

1. Установите Docker

2. Установите последнюю версию docker-compose отсюда: https://github.com/docker/compose/releases

Создайте файл docker-compose.yml со следующим содержимым:

```
version: '2'
services:
  postgres:
    image: postgres:10
    ports:
      - 5432:5432
```

И запустите `docker-compose up`

По итогу вы получите запущенный сервер PostgreSQL. Запускайте эту команду в отдельном окне перед запуском сервера приложения.

Создайте файл Procfile и напишите туда следующее:

```
web: rails server
```

Затем, создайте файл .env и укажите в нем:

```
DATABASE_URL=postgres://postgres@localhost/blog
```

Проверьте, запустив команду `foreman start`. Если сервер запустился - значит всё ок. В дальнейшем запускайте сервер только через эту команду.

Внесите файл `.env` в `.gitignore`

### Создание БД

```
foreman run rails db:create
```

### Devise

Установите Devise по гайду на сайте, добавьте локализацию (находится в гугле). (не забудьте, что команды нужно запускать через foreman run)

Добавьте поле admin:boolean в модель пользователя (отдельной миграцией)

`foreman run rails db:migrate`

### Генерация моделей и заготовок контроллеров

На основе описанной структуры БД, с помощью команды `rails generate scaffold` ([подробнее о этой команде](http://guides.rubyonrails.org/command_line.html#rails-generate)) сгенерируйте модели и заготовки контроллеров

Покажите миграции проверяющему и если всё ок - примените их.

### Bootstrap

В application_layout подключите Bootstrap 4 через bootstrapcdn.

Сделайте базовый шаблон, с шапкой и контентом по центру.

Так же, установите gem bootstrap_form

### CanCanCan, права доступа

Установите CanCanCan и напишите Abilities согласно заданию

### Валидации

Добавьте в модель постов необходимые валидации. В первую очередь, на наличие всех полей и на длину текста в них.

### Страница добавления нового поста

Должна быть доступна только зарегистрированным пользователям.

### Главная и вывод одного поста

Добавьте вывод постов на главную и страницу с одним постом. Не забудьте, что кнопки "редактировать" и "удалить" должны показываться только автору поста и администраторам.

Используйте Kaminari для пагинации и Redcarpet с параметром filter_html для вывода Markdown.

### Страница редактирования поста и удаление

Сделайте страницу редактирования поста. Не забудьте про права доступа.

### Список статей автора

Добавьте вывод всех статей автора на страницу с карточкой.

### Heroku

Разверните проект на Heroku, следуя туториалу на их сайте.
